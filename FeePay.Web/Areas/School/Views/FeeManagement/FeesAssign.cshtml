@using FeePay.Core.Application.Interface.Service;
@inject ICommanDataServices CommanDataServices
@model AssignFeesViewModel
@{
    bool IsFindStudent = (Model != null && Model.StudentAdmissionList != null && Model.StudentAdmissionList.Count > 0);
    bool IsFindFeeGroup = (Model != null && Model.FeeGroup != null && Model.FeeGroup.FeeMaster != null && Model.FeeGroup.FeeMaster.Count > 0);
}
@section Style{


}
@section Scripts{
    <partial name="_ValidationScriptsPartial" />
    <script src="@Url.Content("~/Page_js/school/index_feesassign.js")"></script>
}
<div class="container-fluid">
    <div class="page-title">
        <div class="row">
            <div class="col-6">
                <h3>@ViewData["Title"]</h3>
            </div>
            <div class="col-6">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="@Url.Action("Index","Home")"> <i data-feather="home"></i></a></li>
                    <li class="breadcrumb-item">Fee Management</li>
                    <li class="breadcrumb-item active">@ViewData["Title"]</li>
                </ol>
            </div>
        </div>
    </div>
</div>


<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            @{ await Html.RenderPartialAsync("_Partial_SearchStudent", Model); }            
            @if (IsFindFeeGroup)
            {
                <div class="card">
                    <div class="card-body" style="">
                        <div class="table-responsive">
                            <h6>@Model.FeeGroup.Name </h6>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Name</th>
                                        <th scope="col">Amount [₹]</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        for (int i = 0; i < Model.FeeGroup.FeeMaster.Count; i++)
                                        {
                                            var feetype = Model.FeeGroup.FeeType;
                                            var feemaster = Model.FeeGroup.FeeMaster;
                                            <tr>
                                                <th scope="row">@(i + 1)</th>
                                                <td>@($"{feetype[i]?.Name}({feetype[i]?.Code})")</td>
                                                <td>@feemaster[i].Amount</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            }
            @if (IsFindStudent)
            {
                <div class="card">
                    <form id="assignform" asp-controller="FeeManagement" asp-action="AssignToStudent" asp-route-id="@Model.FeeGroup.Id" method="post">
                        @*<form id="assignform" asp-action="FeesAssign" asp-controller="FeeManagement" method="post">*@
                        @Html.AntiForgeryToken()
                        <div class="card-body" style="">
                            <div class="table-responsive">
                                <table class="table" id="assignfees_table">
                                    <thead>
                                        <tr>
                                            <th><input class="" name="assignCkAll" type="checkbox"></th>
                                            <th>Sr/Reg No</th>
                                            <th>Name</th>
                                            <th>Father's Name</th>
                                            <th>MobileNo</th>
                                            <th>Class | Section</th>
                                            <th>Mother's Name</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @for (int i = 0; i < Model.StudentAdmissionList.Count; i++)
                                        {
                                            var item = Model.StudentAdmissionList[i];
                                            <tr data-key="@item.Id">
                                                <th scope="row">
                                                    <label asp-for="@Model.CbStudents[i].IsSelected">
                                                        <input class="assign-checkbox checkbox_animated" asp-for="@Model.CbStudents[i].IsSelected" type="checkbox">
                                                        <input type="hidden" asp-for="@Model.CbStudents[i].Name" />
                                                        <input type="hidden" asp-for="@Model.CbStudents[i].Id" />
                                                    </label>
                                                </th>
                                                <td>@item.Sr_RegNo</td>
                                                <td>@(item.FirstName + " " + item.LastName)</td>
                                                <td>@item.FatherName</td>
                                                <td>@item.MobileNo</td>
                                                <td>@($"{item.StudentClass?.Name} | {item.StudentSection?.NormalizedName}")</td>
                                                <td>@item.MotherName</td>
                                                <td>
                                                    @if (item.IsActive)
                                                    {<label class="badge badge-success">Active</label>}
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="form-group mb-0 text-right"><input type="submit" class="btn btn-success mr-3" value="Assign" /></div>
                        </div>
                    </form>
                </div>
            }
        </div>
    </div>
</div>